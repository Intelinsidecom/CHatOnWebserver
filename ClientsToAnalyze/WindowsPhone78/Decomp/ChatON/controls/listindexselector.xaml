<UserControl x:Class="ChatOn.Controls.ListIndexSelector"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:toolkit="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone.Controls.Toolkit"
    xmlns:local="clr-namespace:ChatOn.Controls"
    mc:Ignorable="d"
    FontFamily="{StaticResource PhoneFontFamilyNormal}"
    FontSize="{StaticResource PhoneFontSizeNormal}"
    Foreground="{StaticResource PhoneForegroundBrush}"
    d:DesignHeight="480" d:DesignWidth="480"
    toolkit:TiltEffect.IsTiltEnabled="True">
    <UserControl.Resources>
        <local:IndexToPanelColor x:Key="IndexToPanelColor"/>
        <local:IndexToTextColor x:Key="IndexToTextColor"/>
        <local:HeaderTypeToImage x:Key="HeaderTypeToImage"/>

        <DataTemplate x:Key="DataTemplate1">
    		<Grid x:Name="grid" Margin="0,0,10,10" Width="100" Height="100" Opacity ="0">
                <Grid.Resources>
    				<Storyboard x:Name="Appear">
    					<DoubleAnimation Duration="0:0:0.3" To="1" Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="grid" d:IsOptimized="True">
    						<DoubleAnimation.EasingFunction>
    							<QuinticEase EasingMode="EaseIn"/>
    						</DoubleAnimation.EasingFunction>
    					</DoubleAnimation>
                		<DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Projection).(PlaneProjection.RotationX)" Storyboard.TargetName="grid">
                			<EasingDoubleKeyFrame KeyTime="0" Value="-90"/>
                			<EasingDoubleKeyFrame KeyTime="0:0:0.3" Value="0"/>
                		</DoubleAnimationUsingKeyFrames>
                	</Storyboard>
    				<Storyboard x:Name="Disappear">
    					<DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Projection).(PlaneProjection.RotationX)" Storyboard.TargetName="grid">
    						<SplineDoubleKeyFrame KeyTime="0" Value="0"/>
    						<SplineDoubleKeyFrame KeyTime="0:0:0.2" Value="90"/>
    					</DoubleAnimationUsingKeyFrames>
    				</Storyboard>
                </Grid.Resources>
                <Grid.Projection>
    				<PlaneProjection/>
                </Grid.Projection>
                <Grid Tag="tilt" Background="{Binding Index,Converter={StaticResource IndexToPanelColor}}" Tap="Grid_Tap">
                    <TextBlock Visibility="{Binding HeaderType, Converter={StaticResource IntEqualToVisibility},ConverterParameter='4'}"
                               Foreground="{Binding Index,Converter={StaticResource IndexToTextColor}}" Margin="10,10,0,0" TextWrapping="Wrap" Text="{Binding Title}" VerticalAlignment="Bottom" HorizontalAlignment="Left" FontSize="44" FontFamily="Segoe WP Semibold"/>
                    <Image Source="{Binding HeaderType,Converter={StaticResource HeaderTypeToImage}}"
                           Visibility="{Binding HeaderType, Converter={StaticResource SmallerThanParamToVisibility},ConverterParameter='4'}"
                           HorizontalAlignment="Left" Stretch="Fill" VerticalAlignment="Top"/>
                </Grid>
            </Grid>
    	</DataTemplate>

        <DataTemplate x:Key="DataTemplate2">
            <Grid x:Name="grid" Margin="0,0,10,10" Opacity ="0">
                <Grid.Resources>
                    <Storyboard x:Name="Appear">
                        <DoubleAnimation Duration="0:0:0.2" To="1" Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="grid" d:IsOptimized="True">
                            <DoubleAnimation.EasingFunction>
                                <QuinticEase EasingMode="EaseIn"/>
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                        <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Projection).(PlaneProjection.RotationX)" Storyboard.TargetName="grid">
                            <EasingDoubleKeyFrame KeyTime="0" Value="-90"/>
                            <EasingDoubleKeyFrame KeyTime="0:0:0.2" Value="0"/>
                        </DoubleAnimationUsingKeyFrames>
                    </Storyboard>
                    <Storyboard x:Name="Disappear">
                        <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Projection).(PlaneProjection.RotationX)" Storyboard.TargetName="grid">
                            <SplineDoubleKeyFrame KeyTime="0" Value="0"/>
                            <SplineDoubleKeyFrame KeyTime="0:0:0.2" Value="90"/>
                        </DoubleAnimationUsingKeyFrames>
                    </Storyboard>
                </Grid.Resources>
                <Grid.Projection>
                    <PlaneProjection/>
                </Grid.Projection>
                <Grid Tag="tilt" Tap="Grid_Tap">
                	<Grid.Background>
                		<SolidColorBrush Color="{StaticResource PhoneAccentColor}"/>
                	</Grid.Background>
                    <TextBlock Foreground="White" Margin="10,15,0,0" TextWrapping="Wrap" Text="{Binding Title}" FontSize="32" FontFamily="Segoe WP" VerticalAlignment="Center"/>
                </Grid>
            </Grid>
        </DataTemplate>
        
        <DataTemplate x:Key="ContentTemplate1">
            <Grid>
                <ItemsControl Loaded="ItemsControl_Loaded" LayoutUpdated="IndexItems_LayoutUpdated" ItemTemplate="{StaticResource DataTemplate1}" ItemsSource="{Binding}" VerticalAlignment="Top" Margin="20,40,0,0">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <toolkit:WrapPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </Grid>
        </DataTemplate>
        
        <DataTemplate x:Key="ContentTemplate2">
            <Grid>
                <ItemsControl Loaded="ItemsControl_Loaded" LayoutUpdated="IndexItems_LayoutUpdated" ItemTemplate="{StaticResource DataTemplate2}" ItemsSource="{Binding}" VerticalAlignment="Top" Margin="20,40,0,0"/>
            </Grid>
        </DataTemplate>
    </UserControl.Resources>

    <Grid x:Name="LayoutRoot">
        <Grid Background="Black" Opacity="0.6"/>
        <ScrollViewer>
            <ContentControl x:Name="MainContent" VerticalContentAlignment="Top" HorizontalContentAlignment="Stretch" ContentTemplate="{StaticResource ContentTemplate1}"/>
        </ScrollViewer>
    </Grid>
</UserControl>
