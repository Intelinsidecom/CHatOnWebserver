<phone:PhoneApplicationPage
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:phone="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone"
    xmlns:shell="clr-namespace:Microsoft.Phone.Shell;assembly=Microsoft.Phone"
    xmlns:controls="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone.Controls"
    xmlns:Customcontrols="clr-namespace:ChatOn.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
    xmlns:ChatOn_Models="clr-namespace:ChatOn.Models" 
    xmlns:toolkit="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone.Controls.Toolkit"
    x:Class="ChatOn.ChatChooserPage" 
    mc:Ignorable="d"
    SupportedOrientations="Portrait"  Orientation="Portrait"
    shell:SystemTray.IsVisible="False"
    toolkit:TiltEffect.IsTiltEnabled="True" d:DesignHeight="800" d:DesignWidth="480">
    <phone:PhoneApplicationPage.Resources>
        <DataTemplate x:Key="IndexNormalTemplate">
            <Grid Height="62" Width="62">
                <TextBlock TextWrapping="Wrap" VerticalAlignment="Bottom" HorizontalAlignment="Left" Margin="10,0,0,12" Text="{Binding HeaderName}" Foreground="#FCFFFFFF"/>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="IndexFavoriteTemplate">
            <Grid Height="62" Width="62">
                <Image HorizontalAlignment="Left" Source="/ChatOn;component/Images/icon_favorites.png" Stretch="Fill" Width="62" VerticalAlignment="Top"/>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="IndexBirthdayTemplate">
            <Grid Height="62" Width="62">
                <Image HorizontalAlignment="Left" Source="/ChatOn;component/Images/icon_birth.png" Stretch="Fill" Width="62" VerticalAlignment="Top"/>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="IndexNewTemplate">
            <Grid Height="62" Width="62">
                <Image HorizontalAlignment="Left" Source="/ChatOn;component/Images/icon_new.png" Stretch="Fill" Width="62" VerticalAlignment="Top"/>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="IndexGroupTemplate">
            <Grid Height="62" Width="62">
                <Image HorizontalAlignment="Left" Source="/ChatOn;component/Images/icon_group.png" Stretch="Fill" Width="62" VerticalAlignment="Top"/>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="IndexItemTemplate">
            <Grid Tap="ListIndex_Tap" HorizontalAlignment="Left" Height="62" Width="62" VerticalAlignment="Top" Margin="0,6" Background="{StaticResource PhoneAccentBrush}">
                <ContentControl HorizontalAlignment="Left" VerticalAlignment="Top" 
                                ContentTemplate="{Binding HeaderType, Converter={StaticResource IndexToTemplate}, ConverterParameter='IndexNewTemplate,IndexBirthdayTemplate,IndexFavoriteTemplate,IndexGroupTemplate,IndexNormalTemplate,ChatChooserPage'}" 
                                Content="{Binding}"/>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="BuddyItemTemplate">
            <Grid Margin="0,0,0,6" Tap="BuddyItem_Tap">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="62"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Image Source="{Binding Buddy.ProfileImage}" Width="62" Height="62" Stretch="UniformToFill" Margin="0,6,0,0" VerticalAlignment="Top"/>
                <Grid Grid.Column="1" Margin="12,0,0,0" Width="367" Background="Transparent">
                    <Grid.RowDefinitions>
                        <RowDefinition/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="{Binding Buddy.Name}"
    						TextWrapping="Wrap" FontSize="26" FontFamily="Segoe WP SemiLight" HorizontalAlignment="Left" Margin="0" Foreground="{StaticResource PhoneForegroundBrush}" VerticalAlignment="Bottom"/>
                    <Customcontrols:DynamicHeightBubble Visibility="{Binding Buddy.Status, Converter={StaticResource StringNullOrEmptyToHide}}"
                                                       Text="{Binding Buddy.Status}" Grid.Row="1" TextMargin="0,-10,0,-18" MaxTextWidth="340"
                                                       Foreground="Black" FontSize="20" Margin="0,0,0,-3"/>
                </Grid>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="BuddyListItemTemplate">
            <Grid Width="442">
                <ContentControl HorizontalAlignment="Left" VerticalAlignment="Top" 
                                ContentTemplate="{Binding Type, Converter={StaticResource IndexToTemplate}, ConverterParameter='IndexItemTemplate,BuddyItemTemplate,ChatChooserPage'}" 
                                Content="{Binding}"/>
            </Grid>
        </DataTemplate>
        <DataTemplate x:Key="ChatItemTemplate">
            <Grid Width="442" Margin="0,6" Tap="ChatItem_Tap">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="62"/>
                    <ColumnDefinition Width="18"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid>
                    <Image Visibility="{Binding SingleChatBuddy, Converter={StaticResource ObjectNullToShow}}" Source="{Binding ChatType, Converter={StaticResource ChatTypeToImageUri}}" Width="62" Height="62" HorizontalAlignment="Left" VerticalAlignment="Top" Stretch="Fill"/>
                    <Image Source="{Binding SingleChatBuddy.ProfileImage}" Width="62" Height="62" HorizontalAlignment="Left" VerticalAlignment="Top" Stretch="Fill"/>        
                </Grid>
                <Grid Grid.Column="2" Width="360" Height="62" Background="Transparent">
                    <Grid.RowDefinitions>
                        <RowDefinition/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="{Binding Title}" VerticalAlignment="Bottom" HorizontalAlignment="Left" FontSize="26" Margin="0,-5,0,0" Foreground="{StaticResource PhoneForegroundBrush}" MaxWidth="280" TextTrimming="WordEllipsis"/>
                    <Customcontrols:ChatTextBlock IsParsingLinkEnabled="False" EmoticonMargin="0,0,0,-8" EmoticonSize="28" Text="{Binding SubTitle}" Grid.Row = "1" MaxLength="80" VerticalAlignment="Bottom" d:LayoutOverrides="GridBox" HorizontalAlignment="Left" Foreground="{StaticResource PhoneForegroundBrush}" MaxWidth="280" Height="28"/>
                    <TextBlock Text="{Binding Date, Converter={StaticResource DateToTimePolicyValue}}"
            			TextWrapping="Wrap" d:LayoutOverrides="GridBox" HorizontalAlignment="Right" FontSize="20" Opacity="0.75" VerticalAlignment="Top" FontFamily="Segoe WP SemiLight" Foreground="{StaticResource PhoneForegroundBrush}"/>
                    <StackPanel HorizontalAlignment="Right" Margin="0,0,0,-6" Grid.Row="1" Orientation="Horizontal" Height="35">
                        <Grid Margin="0" Visibility="{Binding UnreadTrunkMessageCount, ConverterParameter=0, Converter={StaticResource BiggerThanParamToVisibility}}">
                            <Image Source="/ChatOn;component/Images/bubble_blue.png" Stretch="None" VerticalAlignment="Bottom" Height="35"/>
                            <TextBlock Text="{Binding UnreadTrunkMessageCount}"
            					TextWrapping="Wrap" FontSize="18" FontFamily="Segoe WP" d:LayoutOverrides="GridBox" TextAlignment="Center" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,1,0,0" Foreground="#E5FFFFFF"/>
                        </Grid>
                        <Grid Margin="8,0,0,0" Visibility="{Binding UnreadMessageCount, ConverterParameter=0, Converter={StaticResource BiggerThanParamToVisibility}}">
                            <Image Source="/ChatOn;component/Images/bubble_orange.png" Stretch="None" VerticalAlignment="Bottom" Height="35"/>
                            <TextBlock Text="{Binding UnreadMessageCount}"
            					TextWrapping="Wrap" FontSize="18" FontFamily="Segoe WP" d:LayoutOverrides="GridBox" TextAlignment="Center" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,1,0,0" Foreground="#E5FFFFFF"/>
                        </Grid>
                    </StackPanel>
                </Grid>
            </Grid>
        </DataTemplate>
        <ItemsPanelTemplate x:Key="ItemsPanelTemplate">
            <StackPanel Orientation="Horizontal"/>
        </ItemsPanelTemplate>
    </phone:PhoneApplicationPage.Resources>

    <phone:PhoneApplicationPage.FontFamily>
        <StaticResource ResourceKey="PhoneFontFamilyNormal"/>
    </phone:PhoneApplicationPage.FontFamily>
    <phone:PhoneApplicationPage.FontSize>
        <StaticResource ResourceKey="PhoneFontSizeNormal"/>
    </phone:PhoneApplicationPage.FontSize>
    <phone:PhoneApplicationPage.Foreground>
        <StaticResource ResourceKey="PhoneForegroundBrush"/>
    </phone:PhoneApplicationPage.Foreground>

    <!--LayoutRoot is the root grid where all page content is placed-->
    <Grid x:Name="LayoutRoot" Background="Transparent">
        <!--Pivot Control-->
        <controls:Pivot Title="{Binding MyResContainer.IDS_CHATON_BODY_CHATON, Source={StaticResource LocalizedStrings},Converter={StaticResource UpperCaseConverter}}"
                        SelectedIndex="{Binding SelectedPivotIndex, Mode=TwoWay}">
            <!--Pivot item one-->
            <controls:PivotItem Header="{Binding MyResContainer.IDS_CHATON_MBODY_BUDDIES, Source={StaticResource LocalizedStrings}}">
                <Grid x:Name="BuddyGrid">
                    <ListBox x:Name="BuddyList" Margin="14,0,0,0" ItemsSource="{Binding ShowingItems}" ItemTemplate="{StaticResource BuddyListItemTemplate}"/>
                </Grid>
            </controls:PivotItem>

            <!--Pivot item two-->
            <controls:PivotItem Header="{Binding MyResContainer.IDS_CHATON_SK_CHAT_LITE, Source={StaticResource LocalizedStrings}}">
                <Grid>
                    <ListBox Margin="14,0,0,0" ItemsSource="{Binding ChatItems.View}" ItemTemplate="{StaticResource ChatItemTemplate}"/>
                </Grid>
            </controls:PivotItem>
        </controls:Pivot>
    </Grid>

</phone:PhoneApplicationPage>